class ActionLog < ActiveRecord::Base
    def self::get_actions(user, limit = 250)
        logs = ActionLog.find_by_sql("SELECT CONCAT('<a href=\"profile/show/?id=',users.id, '\">', users.name,'</a>') as connection_name, action, CASE action WHEN 'created a new geocache' then (SELECT CONCAT('<a href=\"/geocaches/',id,'\">',name,'</a>') from geocaches WHERE id=action_logs.geocaches_id) WHEN 'connected with' THEN (SELECT CONCAT('<a href=\"/profile/show?id=', id, '\">',name,'</a>') from users where id=action_logs.geocaches_id) WHEN 'found geocache' THEN (SELECT CONCAT('<a href=\"/geocaches/',id,'\">',name,'</a>') from geocaches WHERE id=action_logs.geocaches_id) WHEN 'added to their favorites' THEN (SELECT CONCAT('<a href=\"/geocaches/',geocaches.id,'\">',geocaches.name,'</a>') from geocaches LEFT JOIN favorites on geocaches.id = favorites.geocache_id WHERE favorites.id=action_logs.geocaches_id) end as link, CASE action WHEN 'created a new geocache' THEN '<span><img class=\"icon\" src=\"/images/icons/ruby_get.png\" alt=\"\"/></span>' WHEN 'connected with' THEN '<span><img class=\"icon\" src=\"/images/icons/group_link.png\" alt=\"\"/></span>' WHEN 'found geocache' THEN '<span><img class=\"icon\" src=\"/images/icons/star.png\" alt=\"\"/></span>' WHEN 'added to their favorites' THEN '<span><img class=\"icon\" src=\"/images/icons/heart.png\" alt=\"\"/></span>' end as icons, action_logs.created_at FROM action_logs LEFT JOIN users ON action_logs.users_id = users.id WHERE users_id IN (SELECT connection_id FROM connections WHERE user_id = #{user.id}) ORDER BY action_logs.created_at DESC LIMIT #{limit}")
    rescue
      nil
    end
end
